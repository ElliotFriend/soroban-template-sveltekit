name: Tests

on:
    push:
        branches: [main]
    pull_request:

env:
    PUBLIC_STELLAR_RPC_URL: 'https://soroban-testnet.stellar.org'

jobs:
    build_and_test:
        runs-on: ubuntu-latest

        strategy:
            fail-fast: false
            max-parallel: 4

        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Install pnpm
              uses: pnpm/action-setup@v4
              with:
                  version: 9

            - name: Use Node.js (20.x)
              uses: actions/setup-node@v4
              with:
                  node-version: '20.x'
                  cache: 'pnpm'

            - name: Install Dependencies
              run: pnpm install

            - name: Build
              run: pnpm run build

            - name: Install Playwright
              run: pnpm exec playwright install

            - name: Run Tests
              run: pnpm run test
